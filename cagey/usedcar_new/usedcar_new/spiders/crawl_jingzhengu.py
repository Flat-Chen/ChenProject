# -*- coding: utf-8 -*-
import scrapy
from scrapy.linkextractors import LinkExtractor
from scrapy.spiders import CrawlSpider, Rule
from usedcar_new.items import GanjiItem
import time
import re
from random import shuffle


class CrawlJingzhenguSpider(CrawlSpider):
    name = 'crawl_jingzhengu'
    allowed_domains = ['buycar.jingzhengu.com']
    start_urls_list = ['http://buycar.jingzhengu.com/ershouche//c118-/', 'http://buycar.jingzhengu.com/ershouche//c105-/', 'http://buycar.jingzhengu.com/ershouche//c1511-/', 'http://buycar.jingzhengu.com/ershouche//c1802-/', 'http://buycar.jingzhengu.com/ershouche//c1123-/', 'http://buycar.jingzhengu.com/ershouche//c125-/', 'http://buycar.jingzhengu.com/ershouche//c1825-/', 'http://buycar.jingzhengu.com/ershouche//c603-/', 'http://buycar.jingzhengu.com/ershouche//c1005-/', 'http://buycar.jingzhengu.com/ershouche//c608-/', 'http://buycar.jingzhengu.com/ershouche//c1403-/', 'http://buycar.jingzhengu.com/ershouche//c1714-/', 'http://buycar.jingzhengu.com/ershouche//c1006-/', 'http://buycar.jingzhengu.com/ershouche//c511-/', 'http://buycar.jingzhengu.com/ershouche//c516-/', 'http://buycar.jingzhengu.com/ershouche//c701-/', 'http://buycar.jingzhengu.com/ershouche//c2201-/', 'http://buycar.jingzhengu.com/ershouche//c2829-/', 'http://buycar.jingzhengu.com/ershouche//c2301-/', 'http://buycar.jingzhengu.com/ershouche//c552-/', 'http://buycar.jingzhengu.com/ershouche//c1010-/', 'http://buycar.jingzhengu.com/ershouche//c1702-/', 'http://buycar.jingzhengu.com/ershouche//c2709-/', 'http://buycar.jingzhengu.com/ershouche//c1023-/', 'http://buycar.jingzhengu.com/ershouche//c2925-/', 'http://buycar.jingzhengu.com/ershouche//c507-/', 'http://buycar.jingzhengu.com/ershouche//c2928-/', 'http://buycar.jingzhengu.com/ershouche//c2803-/', 'http://buycar.jingzhengu.com/ershouche//c1004-/', 'http://buycar.jingzhengu.com/ershouche//c2501-/', 'http://buycar.jingzhengu.com/ershouche//c3016-/', 'http://buycar.jingzhengu.com/ershouche//c2110-/', 'http://buycar.jingzhengu.com/ershouche//c422-/', 'http://buycar.jingzhengu.com/ershouche//c1703-/', 'http://buycar.jingzhengu.com/ershouche//c1011-/', 'http://buycar.jingzhengu.com/ershouche//c2308-/', 'http://buycar.jingzhengu.com/ershouche//c906-/', 'http://buycar.jingzhengu.com/ershouche//c412-/', 'http://buycar.jingzhengu.com/ershouche//c2801-/', 'http://buycar.jingzhengu.com/ershouche//c1711-/', 'http://buycar.jingzhengu.com/ershouche//c2118-/', 'http://buycar.jingzhengu.com/ershouche//c113-/', 'http://buycar.jingzhengu.com/ershouche//c2902-/', 'http://buycar.jingzhengu.com/ershouche//c2112-/', 'http://buycar.jingzhengu.com/ershouche//c1602-/', 'http://buycar.jingzhengu.com/ershouche//c1315-/', 'http://buycar.jingzhengu.com/ershouche//c524-/', 'http://buycar.jingzhengu.com/ershouche//c905-/', 'http://buycar.jingzhengu.com/ershouche//c1310-/', 'http://buycar.jingzhengu.com/ershouche//c1520-/', 'http://buycar.jingzhengu.com/ershouche//c1229-/', 'http://buycar.jingzhengu.com/ershouche//c902-/', 'http://buycar.jingzhengu.com/ershouche//c2911-/', 'http://buycar.jingzhengu.com/ershouche//c1701-/', 'http://buycar.jingzhengu.com/ershouche//c1307-/', 'http://buycar.jingzhengu.com/ershouche//c2102-/', 'http://buycar.jingzhengu.com/ershouche//c708-/', 'http://buycar.jingzhengu.com/ershouche//c2401-/', 'http://buycar.jingzhengu.com/ershouche//c2822-/', 'http://buycar.jingzhengu.com/ershouche//c2915-/', 'http://buycar.jingzhengu.com/ershouche//c535-/', 'http://buycar.jingzhengu.com/ershouche//c521-/', 'http://buycar.jingzhengu.com/ershouche//c1613-/', 'http://buycar.jingzhengu.com/ershouche//c1804-/', 'http://buycar.jingzhengu.com/ershouche//c1401-/', 'http://buycar.jingzhengu.com/ershouche//c2103-/', 'http://buycar.jingzhengu.com/ershouche//c2901-/', 'http://buycar.jingzhengu.com/ershouche//c2030-/', 'http://buycar.jingzhengu.com/ershouche//c503-/', 'http://buycar.jingzhengu.com/ershouche//c2601-/', 'http://buycar.jingzhengu.com/ershouche//c1824-/', 'http://buycar.jingzhengu.com/ershouche//c1104-/', 'http://buycar.jingzhengu.com/ershouche//c115-/', 'http://buycar.jingzhengu.com/ershouche//c1021-/', 'http://buycar.jingzhengu.com/ershouche//c2024-/', 'http://buycar.jingzhengu.com/ershouche//c2029-/', 'http://buycar.jingzhengu.com/ershouche//c2831-/', 'http://buycar.jingzhengu.com/ershouche//c2823-/', 'http://buycar.jingzhengu.com/ershouche//c1112-/', 'http://buycar.jingzhengu.com/ershouche//c2132-/', 'http://buycar.jingzhengu.com/ershouche//c2830-/', 'http://buycar.jingzhengu.com/ershouche//c1101-/', 'http://buycar.jingzhengu.com/ershouche//c410-/', 'http://buycar.jingzhengu.com/ershouche//c1013-/', 'http://buycar.jingzhengu.com/ershouche//c2202-/', 'http://buycar.jingzhengu.com/ershouche//c3011-/', 'http://buycar.jingzhengu.com/ershouche//c532300-/', 'http://buycar.jingzhengu.com/ershouche//c1905-/', 'http://buycar.jingzhengu.com/ershouche//c3015-/', 'http://buycar.jingzhengu.com/ershouche//c2114-/', 'http://buycar.jingzhengu.com/ershouche//c911-/', 'http://buycar.jingzhengu.com/ershouche//c715-/', 'http://buycar.jingzhengu.com/ershouche//c2104-/', 'http://buycar.jingzhengu.com/ershouche//c605-/', 'http://buycar.jingzhengu.com/ershouche//c908-/', 'http://buycar.jingzhengu.com/ershouche//c601-/', 'http://buycar.jingzhengu.com/ershouche//c2304-/', 'http://buycar.jingzhengu.com/ershouche//c2120-/', 'http://buycar.jingzhengu.com/ershouche//c2918-/', 'http://buycar.jingzhengu.com/ershouche//c405-/', 'http://buycar.jingzhengu.com/ershouche//c520-/', 'http://buycar.jingzhengu.com/ershouche//c522-/', 'http://buycar.jingzhengu.com/ershouche//c1113-/', 'http://buycar.jingzhengu.com/ershouche//c1412-/', 'http://buycar.jingzhengu.com/ershouche//c2023-/', 'http://buycar.jingzhengu.com/ershouche//c2927-/', 'http://buycar.jingzhengu.com/ershouche//c3006-/', 'http://buycar.jingzhengu.com/ershouche//c1812-/', 'http://buycar.jingzhengu.com/ershouche//c3020-/', 'http://buycar.jingzhengu.com/ershouche//c1204-/', 'http://buycar.jingzhengu.com/ershouche//c803-/', 'http://buycar.jingzhengu.com/ershouche//c3003-/', 'http://buycar.jingzhengu.com/ershouche//c1106-/', 'http://buycar.jingzhengu.com/ershouche//c114-/', 'http://buycar.jingzhengu.com/ershouche//c2206-/', 'http://buycar.jingzhengu.com/ershouche//c3009-/', 'http://buycar.jingzhengu.com/ershouche//c422800-/', 'http://buycar.jingzhengu.com/ershouche//c505-/', 'http://buycar.jingzhengu.com/ershouche//c1207-/', 'http://buycar.jingzhengu.com/ershouche//c1425-/', 'http://buycar.jingzhengu.com/ershouche//c1829-/', 'http://buycar.jingzhengu.com/ershouche//c1902-/', 'http://buycar.jingzhengu.com/ershouche//c515-/', 'http://buycar.jingzhengu.com/ershouche//c1102-/', 'http://buycar.jingzhengu.com/ershouche//c1615-/', 'http://buycar.jingzhengu.com/ershouche//c2303-/', 'http://buycar.jingzhengu.com/ershouche//c101-/', 'http://buycar.jingzhengu.com/ershouche//c2203-/', 'http://buycar.jingzhengu.com/ershouche//c652300-/', 'http://buycar.jingzhengu.com/ershouche//c2707-/', 'http://buycar.jingzhengu.com/ershouche//c3001-/', 'http://buycar.jingzhengu.com/ershouche//c612-/', 'http://buycar.jingzhengu.com/ershouche//c1108-/', 'http://buycar.jingzhengu.com/ershouche//c120-/', 'http://buycar.jingzhengu.com/ershouche//c602-/', 'http://buycar.jingzhengu.com/ershouche//c402-/', 'http://buycar.jingzhengu.com/ershouche//c903-/', 'http://buycar.jingzhengu.com/ershouche//c419000-/', 'http://buycar.jingzhengu.com/ershouche//c714-/', 'http://buycar.jingzhengu.com/ershouche//c1716-/', 'http://buycar.jingzhengu.com/ershouche//c1830-/', 'http://buycar.jingzhengu.com/ershouche//c2105-/', 'http://buycar.jingzhengu.com/ershouche//c429000-/', 'http://buycar.jingzhengu.com/ershouche//c2307-/', 'http://buycar.jingzhengu.com/ershouche//c1503-/', 'http://buycar.jingzhengu.com/ershouche//c1709-/', 'http://buycar.jingzhengu.com/ershouche//c1707-/', 'http://buycar.jingzhengu.com/ershouche//c1109-/', 'http://buycar.jingzhengu.com/ershouche//c1814-/', 'http://buycar.jingzhengu.com/ershouche//c1002-/', 'http://buycar.jingzhengu.com/ershouche//c1510-/', 'http://buycar.jingzhengu.com/ershouche//c116-/', 'http://buycar.jingzhengu.com/ershouche//c1015-/', 'http://buycar.jingzhengu.com/ershouche//c2703-/', 'http://buycar.jingzhengu.com/ershouche//c2907-/', 'http://buycar.jingzhengu.com/ershouche//c2219-/', 'http://buycar.jingzhengu.com/ershouche//c3012-/', 'http://buycar.jingzhengu.com/ershouche//c1003-/', 'http://buycar.jingzhengu.com/ershouche//c2704-/', 'http://buycar.jingzhengu.com/ershouche//c621-/', 'http://buycar.jingzhengu.com/ershouche//c907-/', 'http://buycar.jingzhengu.com/ershouche//c1107-/', 'http://buycar.jingzhengu.com/ershouche//c2027-/', 'http://buycar.jingzhengu.com/ershouche//c1305-/', 'http://buycar.jingzhengu.com/ershouche//c1515-/', 'http://buycar.jingzhengu.com/ershouche//c2821-/', 'http://buycar.jingzhengu.com/ershouche//c104-/', 'http://buycar.jingzhengu.com/ershouche//c1001-/', 'http://buycar.jingzhengu.com/ershouche//c613-/', 'http://buycar.jingzhengu.com/ershouche//c1209-/', 'http://buycar.jingzhengu.com/ershouche//c702-/', 'http://buycar.jingzhengu.com/ershouche//c811-/', 'http://buycar.jingzhengu.com/ershouche//c1217-/', 'http://buycar.jingzhengu.com/ershouche//c1309-/', 'http://buycar.jingzhengu.com/ershouche//c1312-/', 'http://buycar.jingzhengu.com/ershouche//c2306-/', 'http://buycar.jingzhengu.com/ershouche//c2310-/', 'http://buycar.jingzhengu.com/ershouche//c2117-/', 'http://buycar.jingzhengu.com/ershouche//c1304-/', 'http://buycar.jingzhengu.com/ershouche//c2204-/', 'http://buycar.jingzhengu.com/ershouche//c2832-/', 'http://buycar.jingzhengu.com/ershouche//c1216-/', 'http://buycar.jingzhengu.com/ershouche//c103-/', 'http://buycar.jingzhengu.com/ershouche//c532-/', 'http://buycar.jingzhengu.com/ershouche//c416-/', 'http://buycar.jingzhengu.com/ershouche//c1604-/', 'http://buycar.jingzhengu.com/ershouche//c2835-/', 'http://buycar.jingzhengu.com/ershouche//c615-/', 'http://buycar.jingzhengu.com/ershouche//c1201-/', 'http://buycar.jingzhengu.com/ershouche//c1606-/', 'http://buycar.jingzhengu.com/ershouche//c1710-/', 'http://buycar.jingzhengu.com/ershouche//c421-/', 'http://buycar.jingzhengu.com/ershouche//c2210-/', 'http://buycar.jingzhengu.com/ershouche//c2923-/', 'http://buycar.jingzhengu.com/ershouche//c528-/', 'http://buycar.jingzhengu.com/ershouche//c1303-/', 'http://buycar.jingzhengu.com/ershouche//c909-/', 'http://buycar.jingzhengu.com/ershouche//c2903-/', 'http://buycar.jingzhengu.com/ershouche//c1202-/', 'http://buycar.jingzhengu.com/ershouche//c1903-/', 'http://buycar.jingzhengu.com/ershouche//c409-/', 'http://buycar.jingzhengu.com/ershouche//c1236-/', 'http://buycar.jingzhengu.com/ershouche//c1313-/', 'http://buycar.jingzhengu.com/ershouche//c1705-/', 'http://buycar.jingzhengu.com/ershouche//c415-/', 'http://buycar.jingzhengu.com/ershouche//c2113-/', 'http://buycar.jingzhengu.com/ershouche//c810-/', 'http://buycar.jingzhengu.com/ershouche//c619-/', 'http://buycar.jingzhengu.com/ershouche//c107-/', 'http://buycar.jingzhengu.com/ershouche//c1405-/', 'http://buycar.jingzhengu.com/ershouche//c1008-/', 'http://buycar.jingzhengu.com/ershouche//c2227-/', 'http://buycar.jingzhengu.com/ershouche//c910-/', 'http://buycar.jingzhengu.com/ershouche//c108-/', 'http://buycar.jingzhengu.com/ershouche//c1308-/', 'http://buycar.jingzhengu.com/ershouche//c1609-/', 'http://buycar.jingzhengu.com/ershouche//c718-/', 'http://buycar.jingzhengu.com/ershouche//c622900-/', 'http://buycar.jingzhengu.com/ershouche//c1203-/', 'http://buycar.jingzhengu.com/ershouche//c1518-/', 'http://buycar.jingzhengu.com/ershouche//c717-/', 'http://buycar.jingzhengu.com/ershouche//c418-/', 'http://buycar.jingzhengu.com/ershouche//c2914-/', 'http://buycar.jingzhengu.com/ershouche//c2710-/', 'http://buycar.jingzhengu.com/ershouche//c2834-/', 'http://buycar.jingzhengu.com/ershouche//c2833-/', 'http://buycar.jingzhengu.com/ershouche//c1306-/', 'http://buycar.jingzhengu.com/ershouche//c401-/', 'http://buycar.jingzhengu.com/ershouche//c2705-/', 'http://buycar.jingzhengu.com/ershouche//c510-/', 'http://buycar.jingzhengu.com/ershouche//c1301-/', 'http://buycar.jingzhengu.com/ershouche//c3005-/', 'http://buycar.jingzhengu.com/ershouche//c2302-/', 'http://buycar.jingzhengu.com/ershouche//c2026-/', 'http://buycar.jingzhengu.com/ershouche//c1103-/', 'http://buycar.jingzhengu.com/ershouche//c705-/', 'http://buycar.jingzhengu.com/ershouche//c469000-/', 'http://buycar.jingzhengu.com/ershouche//c2922-/', 'http://buycar.jingzhengu.com/ershouche//c1016-/', 'http://buycar.jingzhengu.com/ershouche//c3002-/', 'http://buycar.jingzhengu.com/ershouche//c1505-/', 'http://buycar.jingzhengu.com/ershouche//c1208-/', 'http://buycar.jingzhengu.com/ershouche//c1808-/', 'http://buycar.jingzhengu.com/ershouche//c1704-/', 'http://buycar.jingzhengu.com/ershouche//c1333-/', 'http://buycar.jingzhengu.com/ershouche//c504-/', 'http://buycar.jingzhengu.com/ershouche//c1907-/', 'http://buycar.jingzhengu.com/ershouche//c2929-/', 'http://buycar.jingzhengu.com/ershouche//c1014-/', 'http://buycar.jingzhengu.com/ershouche//c1512-/', 'http://buycar.jingzhengu.com/ershouche//c912-/', 'http://buycar.jingzhengu.com/ershouche//c514-/', 'http://buycar.jingzhengu.com/ershouche//c1406-/', 'http://buycar.jingzhengu.com/ershouche//c2205-/', 'http://buycar.jingzhengu.com/ershouche//c719-/', 'http://buycar.jingzhengu.com/ershouche//c1428-/', 'http://buycar.jingzhengu.com/ershouche//c501-/', 'http://buycar.jingzhengu.com/ershouche//c604-/', 'http://buycar.jingzhengu.com/ershouche//c2106-/', 'http://buycar.jingzhengu.com/ershouche//c532900-/', 'http://buycar.jingzhengu.com/ershouche//c1805-/', 'http://buycar.jingzhengu.com/ershouche//c2305-/', 'http://buycar.jingzhengu.com/ershouche//c1018-/', 'http://buycar.jingzhengu.com/ershouche//c411-/', 'http://buycar.jingzhengu.com/ershouche//c201-/', 'http://buycar.jingzhengu.com/ershouche//c102-/', 'http://buycar.jingzhengu.com/ershouche//c659000-/', 'http://buycar.jingzhengu.com/ershouche//c610-/', 'http://buycar.jingzhengu.com/ershouche//c302-/', 'http://buycar.jingzhengu.com/ershouche//c1136-/', 'http://buycar.jingzhengu.com/ershouche//c2101-/', 'http://buycar.jingzhengu.com/ershouche//c417-/', 'http://buycar.jingzhengu.com/ershouche//c2025-/', 'http://buycar.jingzhengu.com/ershouche//c2701-/', 'http://buycar.jingzhengu.com/ershouche//c809-/', 'http://buycar.jingzhengu.com/ershouche//c2001-/', 'http://buycar.jingzhengu.com/ershouche//c513-/', 'http://buycar.jingzhengu.com/ershouche//c1507-/', 'http://buycar.jingzhengu.com/ershouche//c1513-/', 'http://buycar.jingzhengu.com/ershouche//c1616-/', 'http://buycar.jingzhengu.com/ershouche//c1501-/', 'http://buycar.jingzhengu.com/ershouche//c2828-/', 'http://buycar.jingzhengu.com/ershouche//c901-/', 'http://buycar.jingzhengu.com/ershouche//c110-/', 'http://buycar.jingzhengu.com/ershouche//c106-/', 'http://buycar.jingzhengu.com/ershouche//c607-/', 'http://buycar.jingzhengu.com/ershouche//c1131-/', 'http://buycar.jingzhengu.com/ershouche//c1009-/', 'http://buycar.jingzhengu.com/ershouche//c1502-/', 'http://buycar.jingzhengu.com/ershouche//c109-/', 'http://buycar.jingzhengu.com/ershouche//c1603-/', 'http://buycar.jingzhengu.com/ershouche//c2313-/', 'http://buycar.jingzhengu.com/ershouche//c1601-/', 'http://buycar.jingzhengu.com/ershouche//c1210-/', 'http://buycar.jingzhengu.com/ershouche//c1612-/', 'http://buycar.jingzhengu.com/ershouche//c518-/', 'http://buycar.jingzhengu.com/ershouche//c2109-/', 'http://buycar.jingzhengu.com/ershouche//c1517-/', 'http://buycar.jingzhengu.com/ershouche//c2207-/', 'http://buycar.jingzhengu.com/ershouche//c3101-/', 'http://buycar.jingzhengu.com/ershouche//c1708-/', 'http://buycar.jingzhengu.com/ershouche//c2218-/', 'http://buycar.jingzhengu.com/ershouche//c1713-/', 'http://buycar.jingzhengu.com/ershouche//c1801-/', 'http://buycar.jingzhengu.com/ershouche//c1402-/', 'http://buycar.jingzhengu.com/ershouche//c1803-/', 'http://buycar.jingzhengu.com/ershouche//c502-/', 'http://buycar.jingzhengu.com/ershouche//c1605-/', 'http://buycar.jingzhengu.com/ershouche//c2107-/', 'http://buycar.jingzhengu.com/ershouche//c1901-/', 'http://buycar.jingzhengu.com/ershouche//c1607-/', 'http://buycar.jingzhengu.com/ershouche//c1007-/', 'http://buycar.jingzhengu.com/ershouche//c1302-/', 'http://buycar.jingzhengu.com/ershouche//c1717-/', 'http://buycar.jingzhengu.com/ershouche//c606-/', 'http://buycar.jingzhengu.com/ershouche//c801-/']
    shuffle(start_urls_list)
    start_urls = start_urls_list

    @classmethod
    def update_settings(cls, settings):
        settings.setdict(getattr(cls, 'custom_debug_settings' if getattr(cls, 'is_debug', False) else 'custom_settings', None) or {}, priority='spider')

    def __init__(self, **kwargs):
        super(CrawlJingzhenguSpider, self).__init__(**kwargs)
        self.counts = 0

    is_debug = True
    custom_debug_settings = {
        'MYSQL_SERVER': '192.168.1.94',
        'MYSQL_DB': 'usedcar_update',
        'MYSQL_TABLE': 'jingzhengu_online',
        'WEBSITE': 'jingzhengu',
        'MONGODB_SERVER': '192.168.1.94',
        'MONGODB_DB': 'usedcar_update',
        'MONGODB_COLLECTION': 'jingzhengu_online',
        'CONCURRENT_REQUESTS': 16,
        'DOWNLOAD_DELAY': 0,
        'LOG_LEVEL': 'DEBUG',
        'ITEM_PIPELINES': {
            'usedcar_new.pipelines.GanjiPipeline': 300,
            },
    }

    rules = (
        Rule(LinkExtractor(allow='-w\d+/', restrict_xpaths="//p[@class='page_list']//a[not(contains(text(),'上一页')) and not(contains(text(),'...'))and not(contains(text(),'下一页'))]"), callback='parse_list_url'),
        Rule(LinkExtractor(allow='-w\d+/', restrict_xpaths="//p[@class='page_list']//a[contains(text(),'...')]"), follow=True),
    )

    def parse_list_url(self, response):
        li_div_list = response.xpath("//*[@id='zw_across_list_clearfix']/li")
        for li in li_div_list:
            detail_url = li.xpath(".//div[@class='zw_ac_tit']/a/@href").get()
            if detail_url:
                detail_url = response.urljoin(detail_url)
                # print(detail_url)
                self.counts +=1
        print(self.counts)
                # detail_url = "http://buycar.jingzhengu.com/ershouche/car-8139399.html"

                # yield scrapy.Request(
                #     url=detail_url,
                #     callback=self.parse_detail_url,
                # )

    def parse_detail_url(self, response):
        item = GanjiItem()
        item["carid"] = re.findall("-(.*?).html", response.url)[0]
        item["shortdesc"] = response.xpath("//p[@class='w_cardescot_hed']/text()").get()
        item["price1"] = response.xpath("//p[@class='w_itemoffer_my']/span/text()").get().replace("¥", "").replace(" ", "").replace("\n", "").replace("\r", "")
        item["mileage"] = response.xpath("//p[contains(text(),'行驶里程')]/following-sibling::p/text()").get()
        # item["change_times"] = response.xpath("//li[@class='iNew-hu']//i/text()").get()
        item["car_source"] = 'jingzhengu'
        item["grab_time"] = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
        item["parsetime"] = item["grab_time"]
        item["pagetitle"] = response.xpath("//title/text()").get().replace(" ", "").replace("\n", "").replace("\r", "")
        item["url"] = response.url
        item["brand"] = response.xpath("//div[@class='bread clearfix mt16']/a[2]//text()").get().split('二手')[1]
        item["series"] = response.xpath("//div[@class='bread clearfix mt16']/a[3]//text()").get().split('二手')[1][len(item["brand"]):]
        item["city"] = response.xpath("//p[contains(text(),'城市')]/following-sibling::p/text()").get()
        # print(item)
        output = response.xpath("//p[contains(text(),'排量')]/following-sibling::p/text()").get()
        item["output"] = re.findall("(.*?)L", output)[0]+'L' if output else None
        item["emission"] = re.findall("(\(.*?)\)", output)[0].replace("(", "") if output else None
        # item["guidepricetax"] = response.xpath("//p[contains(text(),'新车指导价')]/following-sibling::p/text()").get().replace("\n", "").replace(" ", "").replace("\r", "")
        item["registerdate"] = response.xpath("//p[contains(text(),'上牌时间')]/following-sibling::p/text()").get()
        item["post_time"] = response.xpath("//span[@class='w_carpr_titri']//text()").get().split('：')[1] if response.xpath("//span[@class='w_carpr_titri']//text()").get() else None
        item["modelname"] = response.xpath("//div[@class='w_cardetails']//input[@id='modelClassificationName']/@value").get()
        item["newcarid"] = response.xpath("//div[@class='w_cardetails']//input[@id='styleId']/@value").get()
        item["pagetime"] = 'zero'
        item["guideprice"] = response.xpath("//p[contains(text(),'新车指导价')]/following-sibling::p/text()").get().replace("\n", "").replace(" ", "").replace("\r", "")
        item["statusplus"] = item["carid"] + '-' + item["price1"]
        item["status"] = 'sale'
        # item["datasave"] = response.xpath('//html').get()
        # print(item)
        yield item
